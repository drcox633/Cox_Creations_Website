<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cox Creations | Gallery</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Manrope:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7f4ef;
      --charcoal: #121212;
      --muted: #3a3a3a;
      --wood: #c28a52;
      --linen: #efe7dc;
      --card: rgba(255, 255, 255, 0.7);
      --shadow: 0 12px 45px rgba(0, 0, 0, 0.08);
      --radius: 18px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Manrope', system-ui, -apple-system, sans-serif;
      color: var(--charcoal);
      background: radial-gradient(1100px at 15% 20%, rgba(194, 138, 82, 0.12), transparent 50%),
                  radial-gradient(1300px at 85% 0%, rgba(18, 18, 18, 0.06), transparent 40%),
                  var(--bg);
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      padding: 32px;
    }
    .page {
      max-width: 1100px;
      margin: 0 auto 72px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }
    .logo {
      font-family: 'Playfair Display', Georgia, serif;
      font-weight: 700;
      font-size: 24px;
      letter-spacing: 0.6px;
    }
    nav a {
      margin-left: 16px;
      color: var(--muted);
      text-decoration: none;
      font-weight: 500;
      font-size: 15px;
    }
    nav a:hover { color: var(--charcoal); }
    .hero {
      background: var(--card);
      border: 1px solid rgba(0,0,0,0.05);
      box-shadow: var(--shadow);
      border-radius: 24px;
      padding: 36px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 28px;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute;
      inset: 18px;
      border: 1px solid rgba(0,0,0,0.04);
      border-radius: 20px;
      pointer-events: none;
    }
    .hero-copy h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: clamp(34px, 5vw, 46px);
      line-height: 1.1;
      margin-bottom: 14px;
    }
    .hero-copy p {
      color: var(--muted);
      margin-bottom: 22px;
      font-size: 16px;
      max-width: 520px;
    }
    .cta-row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    .btn {
      background: var(--charcoal);
      color: var(--bg);
      padding: 13px 18px;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
      box-shadow: 0 14px 34px rgba(0,0,0,0.15);
    }
    .btn:hover { transform: translateY(-2px); background: #1f1f1f; }
    .btn.secondary {
      background: transparent;
      color: var(--charcoal);
      border: 1px solid rgba(0,0,0,0.12);
      box-shadow: none;
      padding: 12px 16px;
    }
    section {
      margin-top: 64px;
    }
    .section-head {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
      margin-bottom: 18px;
    }
    .section-head h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 26px;
    }
    .section-head p {
      color: var(--muted);
      font-size: 15px;
    }
    .gallery {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    .gallery img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,0.04);
      background: var(--linen);
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      cursor: zoom-in;
    }
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.52);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 22px;
      z-index: 20;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    .lightbox.visible {
      opacity: 1;
      pointer-events: auto;
    }
    .lightbox-inner {
      position: relative;
      max-width: min(1000px, 90vw);
      max-height: 90vh;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 22px 80px rgba(0, 0, 0, 0.35);
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      overflow: auto;
      display: block;
    }
    .lightbox img {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 14px;
      transition: transform 0.2s ease, transform-origin 0.2s ease, box-shadow 0.2s ease;
      cursor: zoom-in;
      box-shadow: 0 10px 50px rgba(0,0,0,0.2);
      background: var(--linen);
      display: block;
      margin: 0 auto;
    }
    .lightbox-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.65);
      color: #fff;
      border: none;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.15s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
    }
    .lightbox-close:hover { background: rgba(0,0,0,0.78); transform: translateY(-1px); }

    /* Navigation arrows */
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.65);
      color: #fff;
      border: none;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 20px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.15s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      z-index: 25;
    }
    .lightbox-nav:hover { background: rgba(0,0,0,0.78); }
    .lightbox-nav.prev { left: 20px; }
    .lightbox-nav.next { right: 20px; }

    /* Zoom controls */
    .lightbox-controls {
      position: absolute;
      bottom: 90px;
      right: 20px;
      display: flex;
      gap: 8px;
      z-index: 25;
    }
    .lightbox-btn {
      background: rgba(0,0,0,0.65);
      color: #fff;
      border: none;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.15s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
    }
    .lightbox-btn:hover { background: rgba(0,0,0,0.78); transform: translateY(-1px); }
    .lightbox-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

    /* Thumbnail strip */
    .lightbox-thumbnails {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 80px;
      background: rgba(0,0,0,0.75);
      display: flex;
      align-items: center;
      padding: 10px 20px;
      gap: 10px;
      overflow-x: auto;
      scroll-behavior: smooth;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .lightbox-thumbnails::-webkit-scrollbar { height: 6px; }
    .lightbox-thumbnails::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 3px; }
    .lightbox-thumbnails::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
    .lightbox-thumb {
      flex-shrink: 0;
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
      opacity: 0.5;
      transition: opacity 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      scroll-snap-align: center;
      border: 2px solid transparent;
    }
    .lightbox-thumb:hover { opacity: 0.8; transform: scale(1.05); }
    .lightbox-thumb.active {
      opacity: 1;
      border-color: var(--wood);
      box-shadow: 0 0 12px rgba(194, 138, 82, 0.5);
    }

    /* Fullscreen adjustments */
    .lightbox.fullscreen .lightbox-inner {
      max-width: 100vw;
      max-height: calc(100vh - 80px);
      border-radius: 0;
      border: none;
    }
    .lightbox.fullscreen .lightbox-thumbnails {
      border-radius: 0;
    }

    /* Image container for transform-based zoom */
    .lightbox-image-container {
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
      touch-action: none;
    }
    .lightbox img {
      transform-origin: center center;
      will-change: transform;
      user-select: none;
      -webkit-user-drag: none;
    }
    .lightbox img.zoomed {
      cursor: grab;
    }
    .lightbox img.zoomed.grabbing {
      cursor: grabbing;
    }

    footer {
      margin-top: 36px;
      color: var(--muted);
      font-size: 13px;
      text-align: center;
    }
    @media (max-width: 600px) {
      body { padding: 20px; }
      header { flex-direction: column; align-items: flex-start; gap: 10px; }
      nav a { margin-left: 0; margin-right: 12px; }
      .hero { padding: 26px; }
      .gallery img { height: 200px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">Cox Creations</div>
      <nav>
        <a href="index.html">Home</a>
        <a href="gallery.html">Gallery</a>
        <a href="index.html#contact">Contact</a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-copy">
        <h1>Work in progress, finished with pride.</h1>
        <p>A closer look at the craft: grains, joinery, and the quiet details that make each piece feel personal.</p>
        <div class="cta-row">
          <a class="btn" href="index.html#collection">Shop the Collection</a>
          <a class="btn secondary" href="index.html#contact">Start a custom piece</a>
        </div>
      </div>
    </section>

    <section>
      <div class="section-head">
        <h2>Gallery</h2>
        <p>Every angle tells the story.</p>
      </div>
      <div class="gallery">
        <img src="gallery/IMG_3090%203.jpeg" alt="Woodwork gallery detail 1">
        <img src="gallery/IMG_3091%203.jpeg" alt="Woodwork gallery detail 2">
        <img src="gallery/IMG_3092%203.jpeg" alt="Woodwork gallery detail 3">
        <img src="gallery/IMG_3093%204.jpeg" alt="Woodwork gallery detail 4">
        <img src="gallery/IMG_3094%203.jpeg" alt="Woodwork gallery detail 5">
        <img src="gallery/IMG_3095%203.jpeg" alt="Woodwork gallery detail 6">
        <img src="gallery/IMG_3096%203.jpeg" alt="Woodwork gallery detail 7">
        <img src="gallery/IMG_3097%203.jpeg" alt="Woodwork gallery detail 8">
        <img src="gallery/IMG_3098%203.jpeg" alt="Woodwork gallery detail 9">
        <img src="gallery/IMG_3099%203.jpeg" alt="Woodwork gallery detail 10">
        <img src="gallery/IMG_3100%203.jpeg" alt="Woodwork gallery detail 11">
        <img src="gallery/IMG_3101%204.jpeg" alt="Woodwork gallery detail 12">
        <img src="gallery/IMG_3102%203.jpeg" alt="Woodwork gallery detail 13">
        <img src="gallery/IMG_3103%203.jpeg" alt="Woodwork gallery detail 14">
        <img src="gallery/IMG_3104%203.jpeg" alt="Woodwork gallery detail 15">
        <img src="gallery/IMG_3105%203.jpeg" alt="Woodwork gallery detail 16">
        <img src="gallery/IMG_3106%203.jpeg" alt="Woodwork gallery detail 17">
        <img src="gallery/IMG_3107%203.jpeg" alt="Woodwork gallery detail 18">
        <img src="gallery/IMG_3108%203.jpeg" alt="Woodwork gallery detail 19">
        <img src="gallery/IMG_3109%203.jpeg" alt="Woodwork gallery detail 20">
        <img src="gallery/IMG_3110%203.jpeg" alt="Woodwork gallery detail 21">
        <img src="gallery/IMG_3111%203.jpeg" alt="Woodwork gallery detail 22">
        <img src="gallery/IMG_3112%203.jpeg" alt="Woodwork gallery detail 23">
        <img src="gallery/IMG_3113%203.jpeg" alt="Woodwork gallery detail 24">
        <img src="gallery/IMG_3114%203.jpeg" alt="Woodwork gallery detail 25">
        <img src="gallery/IMG_3115%203.jpeg" alt="Woodwork gallery detail 26">
        <img src="gallery/IMG_3116%203.jpeg" alt="Woodwork gallery detail 27">
        <img src="gallery/IMG_3117%203.jpeg" alt="Woodwork gallery detail 28">
      </div>
    </section>

    <div class="lightbox" aria-hidden="true" role="dialog" aria-label="Gallery image preview">
      <button class="lightbox-nav prev" type="button" aria-label="Previous image">&#8249;</button>
      <button class="lightbox-nav next" type="button" aria-label="Next image">&#8250;</button>

      <div class="lightbox-inner">
        <button class="lightbox-close" type="button" aria-label="Close preview">&times;</button>
        <div class="lightbox-image-container">
          <img src="" alt="Expanded gallery item">
        </div>
      </div>

      <div class="lightbox-controls">
        <button class="lightbox-btn zoom-out" type="button" aria-label="Zoom out">−</button>
        <button class="lightbox-btn zoom-in" type="button" aria-label="Zoom in">+</button>
        <button class="lightbox-btn fullscreen-btn" type="button" aria-label="Toggle fullscreen">⛶</button>
      </div>

      <div class="lightbox-thumbnails" role="listbox" aria-label="Image thumbnails"></div>
    </div>

    <footer>
      Cox Creations — handmade locally with care.
    </footer>
  </div>
  <script>
    // DOM Elements
    const galleryImages = document.querySelectorAll('.gallery img');
    const lightbox = document.querySelector('.lightbox');
    const lightboxImage = lightbox.querySelector('.lightbox-image-container img');
    const imageContainer = lightbox.querySelector('.lightbox-image-container');
    const closeBtn = lightbox.querySelector('.lightbox-close');
    const prevBtn = lightbox.querySelector('.lightbox-nav.prev');
    const nextBtn = lightbox.querySelector('.lightbox-nav.next');
    const zoomInBtn = lightbox.querySelector('.zoom-in');
    const zoomOutBtn = lightbox.querySelector('.zoom-out');
    const fullscreenBtn = lightbox.querySelector('.fullscreen-btn');
    const thumbnailsContainer = lightbox.querySelector('.lightbox-thumbnails');

    // State
    let currentIndex = 0;
    const zoomState = {
      level: 1.0,
      minLevel: 1.0,
      maxLevel: 4.0,
      step: 0.5,
      panX: 0,
      panY: 0
    };

    // Gesture state
    let pointers = new Map();
    let lastPinchDistance = 0;
    let isPanning = false;
    let panStart = { x: 0, y: 0, panX: 0, panY: 0 };
    let swipeStart = { x: 0, y: 0, time: 0 };

    // Build image data array
    const images = Array.from(galleryImages).map((img, i) => ({
      src: img.src,
      alt: img.alt,
      index: i
    }));

    // Generate thumbnails
    function buildThumbnails() {
      thumbnailsContainer.innerHTML = '';
      images.forEach((img, i) => {
        const thumb = document.createElement('img');
        thumb.src = img.src;
        thumb.alt = `Thumbnail ${i + 1}`;
        thumb.className = 'lightbox-thumb';
        thumb.setAttribute('role', 'option');
        thumb.setAttribute('tabindex', '0');
        thumb.addEventListener('click', () => navigateTo(i));
        thumb.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            navigateTo(i);
          }
        });
        thumbnailsContainer.appendChild(thumb);
      });
    }

    // Update thumbnail active state
    function updateThumbnails() {
      const thumbs = thumbnailsContainer.querySelectorAll('.lightbox-thumb');
      thumbs.forEach((thumb, i) => {
        thumb.classList.toggle('active', i === currentIndex);
        if (i === currentIndex) {
          thumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
      });
    }

    // Apply zoom transform
    function applyTransform() {
      const scale = zoomState.level;
      const tx = zoomState.panX;
      const ty = zoomState.panY;
      lightboxImage.style.transform = `scale(${scale}) translate(${tx}px, ${ty}px)`;
      lightboxImage.classList.toggle('zoomed', scale > 1);
      updateZoomButtons();
    }

    // Update zoom button states
    function updateZoomButtons() {
      zoomInBtn.disabled = zoomState.level >= zoomState.maxLevel;
      zoomOutBtn.disabled = zoomState.level <= zoomState.minLevel;
    }

    // Clamp pan to image bounds
    function clampPan() {
      if (zoomState.level <= 1) {
        zoomState.panX = 0;
        zoomState.panY = 0;
        return;
      }
      const rect = imageContainer.getBoundingClientRect();
      const imgRect = lightboxImage.getBoundingClientRect();
      const scale = zoomState.level;

      // Calculate max pan based on overflow
      const maxPanX = Math.max(0, (imgRect.width / scale - rect.width / scale) / 2);
      const maxPanY = Math.max(0, (imgRect.height / scale - rect.height / scale) / 2);

      zoomState.panX = Math.max(-maxPanX, Math.min(maxPanX, zoomState.panX));
      zoomState.panY = Math.max(-maxPanY, Math.min(maxPanY, zoomState.panY));
    }

    // Set zoom level
    function setZoom(level, centerX = 0.5, centerY = 0.5) {
      const oldLevel = zoomState.level;
      zoomState.level = Math.max(zoomState.minLevel, Math.min(zoomState.maxLevel, level));

      // Reset pan when zooming out to 1x
      if (zoomState.level <= 1) {
        zoomState.panX = 0;
        zoomState.panY = 0;
      }

      clampPan();
      applyTransform();
    }

    // Reset zoom state
    function resetZoom() {
      zoomState.level = 1.0;
      zoomState.panX = 0;
      zoomState.panY = 0;
      applyTransform();
    }

    // Navigate to specific image
    function navigateTo(index) {
      currentIndex = (index + images.length) % images.length;
      lightboxImage.src = images[currentIndex].src;
      lightboxImage.alt = images[currentIndex].alt;
      resetZoom();
      updateThumbnails();
    }

    // Open lightbox
    function openLightbox(index) {
      currentIndex = index;
      lightboxImage.src = images[currentIndex].src;
      lightboxImage.alt = images[currentIndex].alt;
      lightbox.classList.add('visible');
      lightbox.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      resetZoom();
      updateThumbnails();
    }

    // Close lightbox
    function closeLightbox() {
      lightbox.classList.remove('visible');
      lightbox.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      resetZoom();
      exitFullscreen();
    }

    // Fullscreen
    function toggleFullscreen() {
      if (document.fullscreenElement) {
        exitFullscreen();
      } else {
        enterFullscreen();
      }
    }

    function enterFullscreen() {
      if (lightbox.requestFullscreen) {
        lightbox.requestFullscreen();
      } else if (lightbox.webkitRequestFullscreen) {
        lightbox.webkitRequestFullscreen();
      }
      lightbox.classList.add('fullscreen');
    }

    function exitFullscreen() {
      if (document.fullscreenElement) {
        document.exitFullscreen?.() || document.webkitExitFullscreen?.();
      }
      lightbox.classList.remove('fullscreen');
    }

    // Pointer event handlers for pinch zoom and pan
    function getDistance(p1, p2) {
      return Math.hypot(p2.x - p1.x, p2.y - p1.y);
    }

    function handlePointerDown(e) {
      pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (pointers.size === 1) {
        // Single touch - start pan or swipe
        swipeStart = { x: e.clientX, y: e.clientY, time: Date.now() };
        if (zoomState.level > 1) {
          isPanning = true;
          panStart = {
            x: e.clientX,
            y: e.clientY,
            panX: zoomState.panX,
            panY: zoomState.panY
          };
          lightboxImage.classList.add('grabbing');
        }
      } else if (pointers.size === 2) {
        // Two touches - start pinch
        const pts = Array.from(pointers.values());
        lastPinchDistance = getDistance(pts[0], pts[1]);
        isPanning = false;
      }
    }

    function handlePointerMove(e) {
      if (!pointers.has(e.pointerId)) return;
      pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (pointers.size === 2) {
        // Pinch zoom
        const pts = Array.from(pointers.values());
        const distance = getDistance(pts[0], pts[1]);
        const scale = distance / lastPinchDistance;
        lastPinchDistance = distance;

        const newLevel = zoomState.level * scale;
        setZoom(newLevel);
      } else if (isPanning && pointers.size === 1) {
        // Pan while zoomed
        const dx = (e.clientX - panStart.x) / zoomState.level;
        const dy = (e.clientY - panStart.y) / zoomState.level;
        zoomState.panX = panStart.panX + dx;
        zoomState.panY = panStart.panY + dy;
        clampPan();
        applyTransform();
      }
    }

    function handlePointerUp(e) {
      pointers.delete(e.pointerId);

      if (pointers.size === 0) {
        // Check for swipe (only when not zoomed)
        if (zoomState.level <= 1 && !isPanning) {
          const dx = e.clientX - swipeStart.x;
          const dy = e.clientY - swipeStart.y;
          const dt = Date.now() - swipeStart.time;
          const velocity = Math.abs(dx) / dt;

          if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy) * 2 && velocity > 0.3) {
            if (dx > 0) {
              navigateTo(currentIndex - 1);
            } else {
              navigateTo(currentIndex + 1);
            }
          }
        }

        isPanning = false;
        lightboxImage.classList.remove('grabbing');
      }

      // Reset pinch when one finger lifts
      if (pointers.size === 1) {
        const pt = Array.from(pointers.values())[0];
        panStart = {
          x: pt.x,
          y: pt.y,
          panX: zoomState.panX,
          panY: zoomState.panY
        };
        isPanning = zoomState.level > 1;
      }
    }

    // Mouse wheel zoom
    function handleWheel(e) {
      if (!lightbox.classList.contains('visible')) return;
      e.preventDefault();

      const delta = e.deltaY > 0 ? -zoomState.step : zoomState.step;
      setZoom(zoomState.level + delta);
    }

    // Event listeners - Gallery images
    galleryImages.forEach((img, i) => {
      img.addEventListener('click', () => openLightbox(i));
      img.setAttribute('tabindex', '0');
      img.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openLightbox(i);
        }
      });
    });

    // Event listeners - Controls
    closeBtn.addEventListener('click', closeLightbox);
    prevBtn.addEventListener('click', () => navigateTo(currentIndex - 1));
    nextBtn.addEventListener('click', () => navigateTo(currentIndex + 1));
    zoomInBtn.addEventListener('click', () => setZoom(zoomState.level + zoomState.step));
    zoomOutBtn.addEventListener('click', () => setZoom(zoomState.level - zoomState.step));
    fullscreenBtn.addEventListener('click', toggleFullscreen);

    // Event listeners - Lightbox background click
    lightbox.addEventListener('click', (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });

    // Event listeners - Keyboard
    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('visible')) return;

      switch (e.key) {
        case 'Escape':
          closeLightbox();
          break;
        case 'ArrowLeft':
          navigateTo(currentIndex - 1);
          break;
        case 'ArrowRight':
          navigateTo(currentIndex + 1);
          break;
        case 'f':
        case 'F':
          toggleFullscreen();
          break;
        case '+':
        case '=':
          setZoom(zoomState.level + zoomState.step);
          break;
        case '-':
        case '_':
          setZoom(zoomState.level - zoomState.step);
          break;
      }
    });

    // Event listeners - Pointer events for gestures
    imageContainer.addEventListener('pointerdown', handlePointerDown);
    imageContainer.addEventListener('pointermove', handlePointerMove);
    imageContainer.addEventListener('pointerup', handlePointerUp);
    imageContainer.addEventListener('pointercancel', handlePointerUp);
    imageContainer.addEventListener('pointerleave', handlePointerUp);

    // Event listeners - Mouse wheel
    imageContainer.addEventListener('wheel', handleWheel, { passive: false });

    // Event listeners - Double-click to toggle zoom
    lightboxImage.addEventListener('dblclick', (e) => {
      if (zoomState.level > 1) {
        resetZoom();
      } else {
        setZoom(2.0);
      }
    });

    // Handle fullscreen change
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        lightbox.classList.remove('fullscreen');
      }
    });

    // Initialize thumbnails
    buildThumbnails();
  </script>
</body>
</html>
